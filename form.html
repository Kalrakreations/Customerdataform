<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Customer Form — Sahil Kalra</title>
  <style>
    :root{--bg:#0b1220;--card:#071021;--text:#e6eef7;--muted:#9fb6cf;--accent:#6cc3ff}
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--text)}
    header{position:fixed;top:0;left:0;right:0;padding:14px 28px;display:flex;justify-content:space-between;align-items:center;z-index:10;background:rgba(2,6,23,0.5)}
    header a{color:var(--text);text-decoration:none;margin-left:18px}
    .wrap{max-width:1000px;margin:110px auto;padding:24px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:28px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    h2{margin:0 0 14px}
    label{display:block;margin-top:12px;font-size:14px;color:var(--muted)}
    input[type="text"], input[type="email"], select, textarea {width:100%;padding:10px 12px;margin-top:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
    input[type="file"] { color: var(--muted); margin-top:8px; }
    .row{display:flex;gap:12px}
    .row .col{flex:1}
    .small{width:160px}
    button{margin-top:16px;padding:12px 16px;border-radius:10px;border:none;background:var(--accent);color:#042033;font-weight:700;cursor:pointer}
    .hint{color:#9fb6cf;font-size:13px;margin-top:8px}
    .hidden{display:none}
    .overlay { position: fixed; inset:0; display:flex;align-items:center;justify-content:center; background: rgba(2,6,23,0.6); z-index:9999; opacity:0; pointer-events:none; transition:opacity .25s }
    .overlay.show { opacity:1; pointer-events:auto }
    .tick { background: #072733; padding:26px 36px; border-radius:12px; box-shadow: 0 18px 50px rgba(2,6,23,0.6); text-align:center }
    .tick svg { width:80px; height:80px; }
    .tick p { color: #bfefff; margin:12px 0 0; font-weight:600 }
    @media(max-width:680px){ .row{flex-direction:column} .small{width:100%} }
  </style>
</head>
<body>
  <header>
    <div style="font-weight:700">Sahil Kalra</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="form.html">Customer Form</a>
    </nav>
  </header>

  <div class="wrap">
    <div class="card">
      <h2>Customer / Lead Form</h2>
      <p class="hint">Fill details. On submit — data will be saved to the Google Sheet automatically.</p>

      <form id="leadForm">
        <label for="eventName">Event Name</label>
        <input list="eventList" id="eventName" name="eventName" placeholder="Type or choose event" autocomplete="off" />
        <datalist id="eventList"></datalist>

        <label for="name">Name *</label>
        <input id="name" name="name" type="text" required placeholder="Full name">

        <label for="company">Company</label>
        <input id="company" name="company" type="text" placeholder="Company name">

        <div class="row">
          <div class="col">
            <label for="designation">Designation</label>
            <select id="designation" name="designation">
              <option value="">--Select--</option>
              <option>Executive</option>
              <option>Manager</option>
              <option>CEO</option>
              <option>Founder</option>
              <option value="Other">Other (type below)</option>
            </select>
            <input id="designationOther" class="hidden" placeholder="Type your designation">
          </div>
          <div class="col">
            <label for="businessType">Business Type</label>
            <select id="businessType" name="businessType">
              <option value="">--Select--</option>
              <option>Employee</option>
              <option>Trader</option>
              <option>Exporter</option>
              <option>E-commerce</option>
              <option>Certification Services</option>
              <option value="Other">Other (type below)</option>
            </select>
            <input id="businessOther" class="hidden" placeholder="Type business type">
          </div>
        </div>

        <div class="row">
          <div class="col small">
            <label for="country">Country</label>
            <select id="country" name="country">
              <option>India</option>
              <option>United States</option>
              <option>United Kingdom</option>
              <option>United Arab Emirates</option>
              <option>Others</option>
            </select>
            <input id="countryOther" class="hidden" placeholder="Type country">
          </div>

          <div class="col">
            <label for="state">State</label>
            <select id="state" name="state"></select>
            <input id="stateOther" class="hidden" placeholder="Type state">
          </div>

          <div class="col">
            <label for="city">City</label>
            <select id="city" name="city"></select>
            <input id="cityOther" class="hidden" placeholder="Type city">
          </div>
        </div>

        <label for="visitingCard">Upload Visiting Card (optional)</label>
        <input id="visitingCard" type="file" accept="image/*,.pdf">

        <button type="submit">Submit</button>
        <p id="status" class="hint"></p>
      </form>
    </div>
  </div>

  <!-- Success overlay -->
  <div id="overlay" class="overlay">
    <div class="tick">
      <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="64" height="64" rx="12" fill="#042A2F"/>
        <path d="M45 22L27.5 39.5L19 31" stroke="#6CE6B5" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <p>Submitted successfully!</p>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzs6J9bQBD9BDxcaSx0y3Q7YRMGX4jJDcFVioJtoJt5Ln1ZHjofzE1M53fKhNbjnq6a/exec"; // ← REPLACE with your Apps Script Web App URL

    // ====== State -> City map (major cities; "Other" still allowed) ======
    const stateCityMap = {
      "Andhra Pradesh": ["Visakhapatnam","Vijayawada","Guntur","Tirupati","Nellore"],
      "Arunachal Pradesh": ["Itanagar","Tawang","Ziro"],
      "Assam": ["Guwahati","Dibrugarh","Jorhat","Silchar"],
      "Bihar": ["Patna","Gaya","Bhagalpur","Muzaffarpur"],
      "Chhattisgarh": ["Raipur","Bilaspur","Durg","Bhilai"],
      "Goa": ["Panaji","Margao","Vasco da Gama"],
      "Gujarat": ["Ahmedabad","Surat","Vadodara","Rajkot","Bhavnagar"],
      "Haryana": ["Gurugram","Faridabad","Panchkula","Ambala","Hisar"],
      "Himachal Pradesh": ["Shimla","Dharamshala","Solan","Kangra"],
      "Jharkhand": ["Ranchi","Jamshedpur","Dhanbad","Bokaro"],
      "Karnataka": ["Bengaluru","Mysore","Mangalore","Hubli"],
      "Kerala": ["Thiruvananthapuram","Kochi","Kozhikode","Kollam"],
      "Madhya Pradesh": ["Bhopal","Indore","Gwalior","Jabalpur","Ujjain"],
      "Maharashtra": ["Mumbai","Pune","Nagpur","Nashik","Aurangabad"],
      "Manipur": ["Imphal"],
      "Meghalaya": ["Shillong"],
      "Mizoram": ["Aizawl"],
      "Nagaland": ["Kohima","Dimapur"],
      "Odisha": ["Bhubaneswar","Cuttack","Rourkela","Puri"],
      "Punjab": ["Chandigarh","Ludhiana","Amritsar","Jalandhar","Patiala"],
      "Rajasthan": ["Jaipur","Jodhpur","Udaipur","Bikaner","Kota"],
      "Sikkim": ["Gangtok"],
      "Tamil Nadu": ["Chennai","Coimbatore","Madurai","Tiruchirappalli","Salem"],
      "Telangana": ["Hyderabad","Warangal","Nizamabad"],
      "Tripura": ["Agartala"],
      "Uttar Pradesh": ["Lucknow","Kanpur","Varanasi","Agra","Meerut"],
      "Uttarakhand": ["Dehradun","Haridwar","Nainital"],
      "West Bengal": ["Kolkata","Howrah","Durgapur","Siliguri"],
      "Andaman & Nicobar": ["Port Blair"],
      "Chandigarh": ["Chandigarh"],
      "Dadra & Nagar Haveli and Daman & Diu": ["Daman","Diu","Silvassa"],
      "Delhi": ["New Delhi"],
      "Jammu & Kashmir": ["Srinagar","Jammu"],
      "Ladakh": ["Leh"],
      "Lakshadweep": ["Kavaratti"],
      "Puducherry": ["Puducherry"]
    };

    // ====== DOM refs ======
    const stateSelect = document.getElementById('state');
    const citySelect = document.getElementById('city');
    const stateOther = document.getElementById('stateOther');
    const cityOther = document.getElementById('cityOther');
    const designation = document.getElementById('designation');
    const designationOther = document.getElementById('designationOther');
    const business = document.getElementById('businessType');
    const businessOther = document.getElementById('businessOther');
    const country = document.getElementById('country');
    const countryOther = document.getElementById('countryOther');
    const eventDatalist = document.getElementById('eventList');
    const overlay = document.getElementById('overlay');
    const status = document.getElementById('status');

    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    function populateStates(){
      stateSelect.innerHTML = '';
      const ph = document.createElement('option'); ph.value=''; ph.textContent='--Select State--';
      stateSelect.appendChild(ph);
      Object.keys(stateCityMap).forEach(s => {
        const opt = document.createElement('option'); opt.value = s; opt.textContent = s;
        stateSelect.appendChild(opt);
      });
      const other = document.createElement('option'); other.value='Other'; other.textContent='Other';
      stateSelect.appendChild(other);
      // init city
      citySelect.innerHTML = '<option value="">--Select City--</option>';
      const co = document.createElement('option'); co.textContent = 'Other'; co.value='Other';
      citySelect.appendChild(co);
    }

    function populateCitiesFor(stateName){
      citySelect.innerHTML = '';
      if (!stateName || stateName === '') {
        citySelect.innerHTML = '<option value="">--Select City--</option>';
        const co = document.createElement('option'); co.textContent = 'Other'; co.value='Other';
        citySelect.appendChild(co);
        hide(stateOther); hide(cityOther);
        return;
      }
      if (stateName === 'Other') {
        show(stateOther); stateOther.value = '';
        citySelect.innerHTML = '';
        const other = document.createElement('option'); other.textContent = 'Other'; other.value='Other';
        citySelect.appendChild(other);
        show(cityOther); cityOther.value = '';
        return;
      } else {
        hide(stateOther);
        var cities = stateCityMap[stateName] || [];
        const ph = document.createElement('option'); ph.value=''; ph.textContent='--Select City--';
        citySelect.appendChild(ph);
        cities.forEach(c => {
          const opt = document.createElement('option'); opt.value = c; opt.textContent = c;
          citySelect.appendChild(opt);
        });
        const other = document.createElement('option'); other.textContent = 'Other'; other.value='Other';
        citySelect.appendChild(other);
        hide(cityOther);
      }
    }

    citySelect.addEventListener('change', function(){ if (this.value === 'Other') { show(cityOther); cityOther.value=''; } else hide(cityOther); });
    stateSelect.addEventListener('change', function(){ populateCitiesFor(this.value); });
    designation.addEventListener('change', function(){ if (this.value === 'Other') show(designationOther); else hide(designationOther); });
    business.addEventListener('change', function(){ if (this.value === 'Other') show(businessOther); else hide(businessOther); });
    country.addEventListener('change', function(){ if (this.value === 'Others') show(countryOther); else hide(countryOther); });

    // Fetch event names
    async function fetchEventNames(){
      try {
        const res = await fetch(WEB_APP_URL);
        const json = await res.json();
        eventDatalist.innerHTML = '';
        if (json && Array.isArray(json.events)) {
          json.events.forEach(ev => {
            const opt = document.createElement('option'); opt.value = ev;
            eventDatalist.appendChild(opt);
          });
        }
      } catch (err) {
        console.warn('Could not fetch event names', err);
      }
    }

    // Helper: read file as dataURL (base64)
    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        if (!file) resolve(null);
        const reader = new FileReader();
        reader.onload = function(e){ resolve(e.target.result); };
        reader.onerror = function(e){ reject(e); };
        reader.readAsDataURL(file);
      });
    }

    // Submit handler
    document.getElementById('leadForm').addEventListener('submit', async function(e){
      e.preventDefault();
      status.textContent = '';
      const name = document.getElementById('name').value.trim();
      if (!name) { status.textContent = 'Name is required'; return; }
      const eventName = document.getElementById('eventName').value.trim();
      const company = document.getElementById('company').value.trim();

      let desig = designation.value; if (desig === 'Other') desig = designationOther.value.trim();
      let btype = business.value; if (btype === 'Other') btype = businessOther.value.trim();
      let ctry = country.value; if (ctry === 'Others') ctry = countryOther.value.trim();
      let st = stateSelect.value; if (st === 'Other') st = stateOther.value.trim();
      let cityVal = citySelect.value; if (cityVal === 'Other') cityVal = cityOther.value.trim();

      // file
      const fileInput = document.getElementById('visitingCard');
      let visitingCardBase64 = null, visitingCardName = "", visitingCardType = "";
      if (fileInput.files && fileInput.files[0]) {
        const f = fileInput.files[0];
        visitingCardName = f.name;
        visitingCardType = f.type || "application/octet-stream";
        status.textContent = 'Preparing file...';
        try {
          visitingCardBase64 = await readFileAsDataURL(f); // data:*/*;base64,...
        } catch (err) {
          console.error('File read error', err);
          status.textContent = 'Error reading file';
          return;
        }
      }

      const payload = {
        eventName: eventName || "",
        name: name,
        company: company || "",
        designation: desig || "",
        country: ctry || "India",
        state: st || "",
        city: cityVal || "",
        businessType: btype || "",
        visitingCardBase64: visitingCardBase64, // may be null
        visitingCardName: visitingCardName,
        visitingCardType: visitingCardType
      };

      try {
        status.textContent = 'Submitting...';
        const resp = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const j = await resp.json();
        if (j && j.result === 'success') {
          overlay.classList.add('show');
          setTimeout(()=> overlay.classList.remove('show'), 1400);
          this.reset();
          hide(designationOther); hide(businessOther); hide(countryOther); hide(stateOther); hide(cityOther);
          setTimeout(fetchEventNames, 800);
          status.textContent = '';
        } else {
          status.textContent = 'Submission failed. Check console.';
          console.error('Server response', j);
        }
      } catch (err) {
        status.textContent = 'Error sending data. See console.';
        console.error(err);
      }
    });

    // init
    populateStates();
    populateCitiesFor('');
    fetchEventNames();
  </script>
</body>
</html>
